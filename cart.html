<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Your Cart | MultiversMarket</title>
    <link rel="stylesheet" href="assets/css/style.css">
    <link rel="stylesheet" href="assets/css/animations.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;700;900&family=Rajdhani:wght@300;400;500;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="universe-bg"></div>
    
    <site-header></site-header>

    <main>
        <section class="cart-section">
            <div class="container">
                <h1 class="cart-title">Your <span class="highlight">Cart</span></h1>
                
                <div class="cart-empty" id="cart-empty">
                    <div class="empty-illustration">
                        <object data="assets/svg/empty-cart.svg" type="image/svg+xml" class="empty-svg"></object>
                    </div>
                    <h2>Your dimensional cart is empty</h2>
                    <p>Explore our catalog to find the perfect dimension for your needs.</p>
                    <a href="marketplace.html" class="btn btn-primary">Browse dimensions</a>
                </div>
                
                <div class="cart-content" id="cart-content" style="display: none;">
                    <div class="cart-items" id="cart-items">
                        <!-- Cart items will be dynamically generated by JavaScript -->
                    </div>
                    
                    <div class="cart-summary">
                        <h3>Order Summary</h3>
                        <div class="summary-row">
                            <span>Subtotal</span>
                            <span id="cart-subtotal">0 ETH</span>
                        </div>
                        <div class="summary-row">
                            <span>Dimensional Transfer Fee</span>
                            <span id="cart-fee">0 ETH</span>
                        </div>
                        <div class="summary-row total">
                            <span>Total</span>
                            <span id="cart-total">0 ETH</span>
                        </div>
                        <button class="btn btn-primary checkout-btn">Proceed to Checkout</button>
                        <button class="btn btn-secondary clear-cart-btn">Clear Cart</button>
                    </div>
                </div>
            </div>
        </section>
        
        <section class="recommended-dimensions">
            <div class="container">
                <h2>Recommended <span class="highlight">Dimensions</span></h2>
                <div class="recommended-grid" id="recommended-dimensions">
                    <!-- Recommended dimensions will be dynamically generated by JavaScript -->
                </div>
            </div>
        </section>
    </main>

    <site-footer></site-footer>

    <script src="components/components.js"></script>
    <script src="assets/js/main.js"></script>
    <script>
        // Ensure we're using the consistent 'cartItems' key
        document.addEventListener('DOMContentLoaded', function() {
            // Check if there are items in the old storage key and migrate them
            const oldCart = JSON.parse(localStorage.getItem('dimensionCart')) || [];
            if (oldCart.length > 0) {
                const currentCart = JSON.parse(localStorage.getItem('cartItems')) || [];
                // Only migrate if current cart is empty to avoid duplicates
                if (currentCart.length === 0) {
                    localStorage.setItem('cartItems', JSON.stringify(oldCart));
                    localStorage.removeItem('dimensionCart');
                }
            }
            
            // Check if there are items in the cart (from localStorage)
            const cartItems = JSON.parse(localStorage.getItem('cartItems')) || [];
            
            // Update cart count
            document.querySelector('.cart-count').textContent = cartItems.length;
            
            // Show empty cart or cart content based on items
            if (cartItems.length === 0) {
                document.getElementById('cart-empty').style.display = 'flex';
                document.getElementById('cart-content').style.display = 'none';
            } else {
                document.getElementById('cart-empty').style.display = 'none';
                document.getElementById('cart-content').style.display = 'flex';
                
                // Render cart items
                renderCartItems(cartItems);
                
                // Calculate and update totals
                updateCartTotals(cartItems);
            }
            
            // Clear cart button functionality
            document.querySelector('.clear-cart-btn').addEventListener('click', function() {
                localStorage.removeItem('cartItems');
                document.getElementById('cart-empty').style.display = 'flex';
                document.getElementById('cart-content').style.display = 'none';
                document.querySelector('.cart-count').textContent = '0';
            });
        });
        
        function renderCartItems(items) {
            const cartItemsContainer = document.getElementById('cart-items');
            cartItemsContainer.innerHTML = '';
            
            items.forEach(item => {
                const itemElement = document.createElement('div');
                itemElement.className = 'cart-item';
                itemElement.innerHTML = `
                    <div class="item-image">
                        <img src="${item.image}" alt="${item.name}">
                    </div>
                    <div class="item-details">
                        <h3>${item.name}</h3>
                        <p>${item.category}</p>
                    </div>
                    <div class="item-price">${item.price}</div>
                    <button class="remove-item-btn" data-id="${item.id}">Ã—</button>
                `;
                cartItemsContainer.appendChild(itemElement);
            });
            
            // Add event listeners to remove buttons
            document.querySelectorAll('.remove-item-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const itemId = parseInt(this.getAttribute('data-id'));
                    removeItemFromCart(itemId);
                });
            });
        }
        
        function removeItemFromCart(itemId) {
            let cartItems = JSON.parse(localStorage.getItem('cartItems')) || [];
            cartItems = cartItems.filter(item => item.id !== itemId);
            localStorage.setItem('cartItems', JSON.stringify(cartItems));
            
            // Update cart count
            document.querySelector('.cart-count').textContent = cartItems.length;
            
            if (cartItems.length === 0) {
                document.getElementById('cart-empty').style.display = 'flex';
                document.getElementById('cart-content').style.display = 'none';
            } else {
                renderCartItems(cartItems);
                updateCartTotals(cartItems);
            }
        }
        
        function updateCartTotals(items) {
            // This is a simplified calculation
            let subtotal = 0;
            items.forEach(item => {
                // Extract numeric value from price (e.g., "8.5 ETH" -> 8.5)
                const price = parseFloat(item.price.split(' ')[0]);
                subtotal += price;
            });
            
            const fee = subtotal * 0.05; // 5% fee
            const total = subtotal + fee;
            
            document.getElementById('cart-subtotal').textContent = subtotal.toFixed(2) + ' ETH';
            document.getElementById('cart-fee').textContent = fee.toFixed(2) + ' ETH';
            document.getElementById('cart-total').textContent = total.toFixed(2) + ' ETH';
        }
    </script>
</body>
</html>
